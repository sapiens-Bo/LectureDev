
# Оптимизация с помощью бенчмарка
---
Для оптимизации с помощью бенчмарка необходимо выполнить следующие шаги:
1. Написать код, который нужно оптимизировать
2. Написать бенчмарк для измирения производительности кода.
3. Запустить бенчмарк и проанализировать результаты.
4. Оптимизировать код на основе результатов бенчмарка.
5. Повторять шаги 2-4 до тех пор, пока производительность не будет удовлетворительно.

## Примеры

Для оптимизации кода с помощью бенчмарка можно использовать следующие хаки:

- Использовать быстрый алгоритм или структуру данных.
    
- Избегать аллокаций памяти в циклах.
    
- Избегать лишних вызовов функций.
    
- Избегать использования интерфейсов, если это возможно.
    
- Использовать константы вместо переменных.
### Пример кода неоптимизированной функции Фибоначчи:

```go
func fibonacci(n int) int {
    if n <= 1 {
        return n
    }
    return fibonacci(n-1) + fibonacci(n-2)
}
```

### Пример кода оптимизированной функции Фибоначчи с использованием динамического программирования:

```go
func fibonacciDP(n int) int {
    if n <= 1 {
        return n
    }
    fib := make([]int, n+1)
    fib[0] = 0
    fib[1] = 1
    for i := 2; i <= n; i++ {
        fib[i] = fib[i-1] + fib[i-2]
    }
    return fib[n]
}
```

### Пример кода оптимизированной функции Фибоначчи с использованием формулы Бине:

```go
func fibonacciFormula(n int) int {
    phi := (1 + math.Sqrt(5)) / 2
    return int(math.Round(math.Pow(phi, float64(n)) / math.Sqrt(5)))
}
```
---
### Пример кода, который нужно оптимизировать:

```php
func sum(numbers []int) int {
    result := 0
    for _, number := range numbers {
        result += number
    }
    return result
}

func main() {
    numbers := []int{1, 2, 3, 4, 5}
    for i := 0; i < 1000000; i++ {
        sum(numbers)
    }
}
```

### Пример теста для профилирования кода:

```php
func TestSum(t *testing.T) {
    numbers := []int{1, 2, 3, 4, 5}
    for i := 0; i < 1000000; i++ {
        sum(numbers)
    }
}

func BenchmarkSum(b *testing.B) {
    numbers := []int{1, 2, 3, 4, 5}
    for i := 0; i < b.N; i++ {
        sum(numbers)
    }
}
```

### Запуск теста:

```php
go test -cpuprofile=cpu.prof -memprofile=mem.prof -bench=. -benchmem
```

### Анализ результатов:

```php
go tool pprof -http=:8080 cpu.prof
go tool pprof -http=:8080 mem.prof
```

В этом примере мы видим, что функция sum занимает большую часть времени выполнения программы. Мы можем оптимизировать эту функцию и повторить шаги 2-4 до тех пор, пока производительность не будет удовлетворительной.